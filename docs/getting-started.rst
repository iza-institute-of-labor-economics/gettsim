Getting Started
===============

Installation
------------

The recommended way to install GETTSIM is via `conda <https://conda.io/>`_, the
standard package manager for scientific Python libraries. If conda is not installed on
your machine, please follow the `installation instructions
<https://docs.conda.io/projects/conda/en/latest/user-guide/install/>`_ of its user
guide.

With conda available on your path, installing GETTSIM is as simple as typing

.. code-block:: bash

    $ conda install -c gettsim gettsim

in a command shell.

To validate the installation, start a Python shell and type

.. code-block:: python

    import gettsim

    gettsim.test()


.. _usage:

Usage
-----

Say you have a dataset for the year 2019 that you store in a
`pandas <https://pandas.pydata.org/>`_ DataFrame using the variable name ``data``.
Your dataset needs to adhere to a particular format; all the columns specified in
:ref:`required_cols` below need to be present.

To calculate the taxes and transfers for the households / tax units / individuals in
the dataset, you can use the following Python code:

.. code-block:: python

    from gettsim.tax_transfer import calculate_tax_and_transfers


    calculate_tax_and_transfers(dataset=data, year_of_policy=2019)


The function ``calculate_tax_and_transfers`` will update your dataset ``data`` with the
columns specified below in :ref:`returned_cols`.


.. _required_cols:

Required columns in input data
-------------------------------

+--------------+---------------------------------------------------------+-------------+
|   Variable   |Explanation                                              | Type        +
+==============+=========================================================+=============+
|hid           |Household identifier                                     | Int         |
+--------------+---------------------------------------------------------+-------------+
|tu_id         |Tax Unit identifier                                      | Int         |
+--------------+---------------------------------------------------------+-------------+
|pid           |Personal identifier                                      | Int         |
+--------------+---------------------------------------------------------+-------------+
|head_tu       |Whether individual is head of tax unit                   | Bool        |
+--------------+---------------------------------------------------------+-------------+
|head          |Whether individual is head of household                  | Bool        |
+--------------+---------------------------------------------------------+-------------+
|hhtyp         |                                                         | Int         |
+--------------+---------------------------------------------------------+-------------+
|hhsize        |Size of household                                        | Int         |
+--------------+---------------------------------------------------------+-------------+
|hhsize_tu     |Size of tax unit                                         | Int         |
+--------------+---------------------------------------------------------+-------------+
|adult_num     |Number of adults in household                            | Int         |
+--------------+---------------------------------------------------------+-------------+
|child0_18_num |Number of children between 0 and 18 in household         | Int         |
+--------------+---------------------------------------------------------+-------------+
|hh_wealth     |Wealth of household                                      | Float       |
+--------------+---------------------------------------------------------+-------------+
|m_wage        |Monthly wage of each individual                          | Float       |
+--------------+---------------------------------------------------------+-------------+
|age           |Age of Individual                                        | Int         |
+--------------+---------------------------------------------------------+-------------+
|selfemployed  |Whether individual is self-employed                      | Bool        |
+--------------+---------------------------------------------------------+-------------+
|east          |Whether location in former east or west germany          | Bool        |
+--------------+---------------------------------------------------------+-------------+
|haskids       |Whether individual has kids                              | Bool        |
+--------------+---------------------------------------------------------+-------------+
|m_self        |Monthly wage of selfemployment of each individual        | Float       |
+--------------+---------------------------------------------------------+-------------+
|m_pensions    |Monthly pension payments of each individual              | Float       |
+--------------+---------------------------------------------------------+-------------+
|pkv           |Whether individual is (only) privately health insured    | Bool        |
+--------------+---------------------------------------------------------+-------------+
|m_wage_l1     |                                                         | Float       |
+--------------+---------------------------------------------------------+-------------+
|months_ue     |                                                         | Float       |
+--------------+---------------------------------------------------------+-------------+
|months_ue_l1  |                                                         | Float       |
+--------------+---------------------------------------------------------+-------------+
|months_ue_l2  |                                                         | Float       |
+--------------+---------------------------------------------------------+-------------+
|alg_soep      |                                                         | Float       |
+--------------+---------------------------------------------------------+-------------+
|w_hours       |Weekly working hours of individual                       | Int         |
+--------------+---------------------------------------------------------+-------------+
|child_num_tu  |Number of children in tax unit                           | Int         |
+--------------+---------------------------------------------------------+-------------+
|adult_num_tu  |Number of adults in tax unit                             | Int         |
+--------------+---------------------------------------------------------+-------------+
|byear         |                                                         | Int         |
+--------------+---------------------------------------------------------+-------------+
|exper         |                                                         | Int         |
+--------------+---------------------------------------------------------+-------------+
|avg_ep        |                                                         | Float       |
+--------------+---------------------------------------------------------+-------------+
|EP            |                                                         | Float       |
+--------------+---------------------------------------------------------+-------------+
|child         |                                                         | Bool        |
+--------------+---------------------------------------------------------+-------------+
|pensioner     |                                                         | Bool        |
+--------------+---------------------------------------------------------+-------------+
|m_childcare   |                                                         | Float       |
+--------------+---------------------------------------------------------+-------------+
|m_imputedrent |                                                         | Float       |
+--------------+---------------------------------------------------------+-------------+
|m_kapinc      |                                                         | Float       |
+--------------+---------------------------------------------------------+-------------+
|m_vermiet     |                                                         | Float       |
+--------------+---------------------------------------------------------+-------------+
|miete         |                                                         | Float       |
+--------------+---------------------------------------------------------+-------------+
|divdy         |                                                         | Float       |
+--------------+---------------------------------------------------------+-------------+
|heizkost      |                                                         | Float       |
+--------------+---------------------------------------------------------+-------------+
|renteneintritt|                                                         | Int         |
+--------------+---------------------------------------------------------+-------------+
|handcap_degree|                                                         | Int         |
+--------------+---------------------------------------------------------+-------------+
|wohnfl        |                                                         | Int         |
+--------------+---------------------------------------------------------+-------------+
|zveranl       |                                                         | Bool        |
+--------------+---------------------------------------------------------+-------------+
|ineducation   |                                                         | Bool        |
+--------------+---------------------------------------------------------+-------------+
|alleinerz     |                                                         | Bool        |
+--------------+---------------------------------------------------------+-------------+
|eigentum      |                                                         | Bool        |
+--------------+---------------------------------------------------------+-------------+
|child11_num_tu|                                                         | Int         |
+--------------+---------------------------------------------------------+-------------+
|cnstyr        |                                                         | Int         |
+--------------+---------------------------------------------------------+-------------+
|m_transfers   |                                                         | Int         |
+--------------+---------------------------------------------------------+-------------+
|hh_korr       |                                                         | Int         |
+--------------+---------------------------------------------------------+-------------+


.. _returned_cols:

Columns returned by the simulator
---------------------------------

Note that if one of these columns exists, it will be overwritten.

+-------------------+----------------------------------------------------+-------------+
|   Variable        |Explanation                                         | Type        +
+===================+====================================================+=============+
|svbeit             |                                                     | Float      |
+-------------------+-----------------------------------------------------+------------+
|rvbeit             |                                                     | Float      |
+-------------------+-----------------------------------------------------+------------+
|avbeit             |                                                     | Float      |
+-------------------+-----------------------------------------------------+------------+
|gkvbeit            |                                                     | Float      |
+-------------------+-----------------------------------------------------+------------+
|m_alg1             |                                                     | Float      |
+-------------------+-----------------------------------------------------+------------+
|pensions_sim       |                                                     | Float      |
+-------------------+-----------------------------------------------------+------------+
|zve_abg_nokfb      |                                                     | Float      |
+-------------------+-----------------------------------------------------+------------+
|zve_abg_kfb        |                                                     | Float      |
+-------------------+-----------------------------------------------------+------------+
|kifreib            |                                                     | Float      |
+-------------------+-----------------------------------------------------+------------+
|gross_e1           |                                                     | Float      |
+-------------------+-----------------------------------------------------+------------+
|gross_e5           |                                                     | Float      |
+-------------------+-----------------------------------------------------+------------+
|gross_e6           |                                                     | Float      |
+-------------------+-----------------------------------------------------+------------+
|gross_e7           |                                                     | Float      |
+-------------------+-----------------------------------------------------+------------+
|gross_e1_tu        |                                                     | Float      |
+-------------------+-----------------------------------------------------+------------+
|gross_e4_tu        |                                                     | Float      |
+-------------------+-----------------------------------------------------+------------+
|gross_e5_tu        |                                                     | Float      |
+-------------------+-----------------------------------------------------+------------+
|gross_e6_tu        |                                                     | Float      |
+-------------------+-----------------------------------------------------+------------+
|gross_e7_tu        |                                                     | Float      |
+-------------------+-----------------------------------------------------+------------+
|ertragsanteil      |                                                     | Float      |
+-------------------+-----------------------------------------------------+------------+
|sonder             |                                                     | Float      |
+-------------------+-----------------------------------------------------+------------+
|hhfreib            |                                                     | Float      |
+-------------------+-----------------------------------------------------+------------+
|altfreib           |                                                     | Float      |
+-------------------+-----------------------------------------------------+------------+
|vorsorge           |                                                     | Float      |
+-------------------+-----------------------------------------------------+------------+
|tax_kfb            |                                                     | Float      |
+-------------------+-----------------------------------------------------+------------+
|tax_nokfb          |                                                     | Float      |
+-------------------+-----------------------------------------------------+------------+
|tax_kfb_tu         |                                                     | Float      |
+-------------------+-----------------------------------------------------+------------+
|tax_nokfb_tu       |                                                     | Float      |
+-------------------+-----------------------------------------------------+------------+
|abgst_tu           |                                                     | Float      |
+-------------------+-----------------------------------------------------+------------+
|abgst              |                                                     | Float      |
+-------------------+-----------------------------------------------------+------------+
|soli               |                                                     | Float      |
+-------------------+-----------------------------------------------------+------------+
|soli_tu            |                                                     | Float      |
+-------------------+-----------------------------------------------------+------------+
|kindergeld_basis   |                                                     | Float      |
+-------------------+-----------------------------------------------------+------------+
|kindergeld_tu_basis|                                                     | Float      |
+-------------------+-----------------------------------------------------+------------+
|incometax_tu       |                                                     | Float      |
+-------------------+-----------------------------------------------------+------------+
|incometax          |                                                     | Float      |
+-------------------+-----------------------------------------------------+------------+
|kindergeld         |                                                     | Float      |
+-------------------+-----------------------------------------------------+------------+
|kindergeld_hh      |                                                     | Float      |
+-------------------+-----------------------------------------------------+------------+
|kindergeld_tu      |                                                     | Float      |
+-------------------+-----------------------------------------------------+------------+
|uhv                |                                                     | Float      |
+-------------------+-----------------------------------------------------+------------+
|wohngeld_basis     |                                                     | Float      |
+-------------------+-----------------------------------------------------+------------+
|wohngeld_basis_hh  |                                                     | Float      |
+-------------------+-----------------------------------------------------+------------+
|ar_alg2_ek_hh      |                                                     | Float      |
+-------------------+-----------------------------------------------------+------------+
|alg2_grossek_hh    |                                                     | Float      |
+-------------------+-----------------------------------------------------+------------+
|mehrbed            |                                                     | Float      |
+-------------------+-----------------------------------------------------+------------+
|regelbedarf        |                                                     | Float      |
+-------------------+-----------------------------------------------------+------------+
|regelsatz          |                                                     | Float      |
+-------------------+-----------------------------------------------------+------------+
|alg2_kdu           |                                                     | Float      |
+-------------------+-----------------------------------------------------+------------+
|uhv_hh             |                                                     | Float      |
+-------------------+-----------------------------------------------------+------------+
|ekanrefrei         |                                                     | Float      |
+-------------------+-----------------------------------------------------+------------+
|kiz_temp           |                                                     | Float      |
+-------------------+-----------------------------------------------------+------------+
|kiz_incrange       |                                                     | Float      |
+-------------------+-----------------------------------------------------+------------+
|kiz                |                                                     | Float      |
+-------------------+-----------------------------------------------------+------------+
|wohngeld           |                                                     | Float      |
+-------------------+-----------------------------------------------------+------------+
|m_alg2             |                                                     | Float      |
+-------------------+-----------------------------------------------------+------------+
|dpi_ind            |                                                     | Float      |
+-------------------+-----------------------------------------------------+------------+
|dpi                |                                                     | Float      |
+-------------------+-----------------------------------------------------+------------+
|gross              |                                                     | Float      |
+-------------------+-----------------------------------------------------+------------+
